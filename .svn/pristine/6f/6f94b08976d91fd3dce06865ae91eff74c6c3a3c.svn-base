package com.epam.lab.developers.game;

import java.util.ArrayList;
import java.util.List;
import java.util.TimerTask;

import com.epam.lab.developers.entity.User;
import com.epam.lab.developers.game.map.unit.Unit;

public class GameTask extends TimerTask {
	private Game game;
	private float codeLines;
//	private List<Active> activeList = new ArrayList<>();

	public GameTask(Game game) {
		super();
		this.game = game;
//		for (User user : game.getPlayers())
//			activeList.addAll(user.getTeam().getUnits());

		// for(MapObject[] tmpArray : game.getMap().getMapObjects())
		// for(MapObject tmpObj : tmpArray)
		// if(tmpObj instanceof Active) activeList.add((Active)tmpObj);

	}

	@Override
	public void run() {
		
		for (User user : game.getPlayers()){
			codeLines=0;
			
			for(Unit unit : user.getTeam().getUnits()){
				try{
					unit.action();
					codeLines+=unit.getCodeLines();
				} catch(Exception e){
					e.printStackTrace();
					System.out.println("Can not do unit.action()");					
				}
				
				
			}
			user.getTeam().setCodeLines(codeLines);
			if (codeLines>=game.CODE_LINES){			
				game.finish(user);		
			}
			
		}		
		
		
//		for (Active object : activeList) {
//			object.action();
//		}
	}

	public Game getGame() {
		return game;
	}

	public void setGame(Game game) {
		this.game = game;
	}

}
