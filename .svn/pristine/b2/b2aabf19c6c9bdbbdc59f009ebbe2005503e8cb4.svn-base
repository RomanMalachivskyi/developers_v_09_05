$(function() {
	

	var s_Send = $("#s_Send");				//кнопочка Send/ Вик. для відсилання повідомлення на сервлет
	var output_chat = $("#output_chat");	//textarea для вводу повідомлення в чаті
	var div_chat = $("#div_chat");
	var you = $("#divPlayerYou");
	
	var redColor = "<font color='#cc3333'>";
	var blueColor = "<font color='#3399ff'>";
	var endColor = "</font>";
	
	s_Send.click(function() {				//відсилаємо повідомлення при кліку на кнопці Send
		
		var input_chat = $("#input_chat");	//зчитуємо текст з поля вводу	
		//alert(youName+" "+oponentName);
		$.ajax({
			url: "chat",					//передаємо на сервлет, який має адресу "developers/chat"
			contentType: "application/x-www-form-urlencoded",
			data: {"what":"write","message":input_chat.val()},

		});
		return false;						//щоб не перезавантажувалась сторінка
	});
	
	
	var getChat = function() {				//функція для отримання тексту всього чату
		$.ajax({
			url: "chat",					//звертаємось до сервлет, який має адресу "developers/chat"
			contentType: "application/x-www-form-urlencoded",
			data: {"what":"read","message":"get_me_chat_pls"},
			success: function(chat) {		//отримуємо відповідь
			
				var len = chat.length;		//визначаємо довжину масиву
				var text="";				//очищаємо вікно чату
				
				for(var i=0; i<len; i++){	//створюємо стрічку нових повідомлень
					
					if(chat[i].user == youName){
						text+=redColor+chat[i].user+": "+chat[i].message+"<br>"+endColor;
					} else{
						text+=blueColor+chat[i].user+": "+chat[i].message+"<br>"+endColor;
					}
					
				}
				output_chat.html(text);		//записуємо стрічку нових повідомлень в textarea

						}
		});
	}
	
	function init_chat(){
		setInterval(getChat,2000);			//запускаєм опитування чату на сервері кожні 2 секунди
		
	}
	
	 $(document).ready(function(){
	    	
	    	$(".block").draggable();
	    	$(".block").droppable();
	    	
	    });
	 
	init_chat();
	
});