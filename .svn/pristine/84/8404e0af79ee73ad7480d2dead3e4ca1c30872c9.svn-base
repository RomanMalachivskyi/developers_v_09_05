package com.epam.lab.developers.data;

import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.epam.lab.developers.dao.ActiveObjectDAO;
import com.epam.lab.developers.dao.MapDAO;
import com.epam.lab.developers.dao.PassiveObjectDAO;
import com.epam.lab.developers.dao.UnitDAO;
import com.epam.lab.developers.game.Team;
import com.epam.lab.developers.game.map.GameMap;
import com.epam.lab.developers.game.map.object.ActiveObject;
import com.epam.lab.developers.game.map.unit.Unit;

public class MapManager {

	private MapDAO mapDAO = new MapDAO();
	
	private PassiveObjectDAO pObjectDAO = new PassiveObjectDAO();
	private ActiveObjectDAO aObjectDAO = new ActiveObjectDAO();
	private UnitDAO unitDAO = new UnitDAO();
	
	private GameMap gameMap;
	private List<Team> mapTeams;
	
	
	public MapManager(int mapId) throws SQLException{
		initMapItems(mapId);
	}
	
	public MapManager(String mapName) throws SQLException{
		
		initMapItems(mapDAO.getMapID(mapName));
	}
	
	public GameMap getMap(){
		return gameMap;
	}
	
	public List<Team> getTeams(){
		return mapTeams;
	}
	
	private void initMapItems(int mapId) throws SQLException{
		this.gameMap = mapDAO.getById(mapId);
		
		this.gameMap.setMapObjects(pObjectDAO.getAllByMapId(mapId));

		List<Integer> teamIdList = mapDAO.getTeams(mapId);
		this.mapTeams = new ArrayList<Team>();
		
		for(int i=0;i<teamIdList.size();i++){
			
			List<ActiveObject> objs = aObjectDAO.getAllByTeamId(teamIdList.get(i));
			List<Unit> units = unitDAO.getAllByTeamId(teamIdList.get(i));
			
			
			mapTeams.add(new Team(teamIdList.get(i),objs,units));
		}
	}
	
}
